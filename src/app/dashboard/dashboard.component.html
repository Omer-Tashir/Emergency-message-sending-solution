<app-toolbar></app-toolbar>

<div class="main-section" [@fadeInOnEnter]>
    
    <h1>אירוע מספר: {{incident?.uid}}</h1>

    <div class="dashboard-container">
        <div class="dashboard-container--right">
            <div class="dashboard-item">
                <p>אנשי קשר</p>
                <strong [countUp]="contacts" [options]="countUpOptions"></strong>
            </div>
            <div class="dashboard-item">
                <p>בתהליך</p>
                <strong [countUp]="pending" [options]="countUpOptions"></strong>
            </div>
            <div class="dashboard-item">
                <p>כישלון חיוג</p>
                <strong [countUp]="failed" [options]="countUpOptions"></strong>
            </div>
            <div class="dashboard-item">
                <p>דחית שיחה</p>
                <strong [countUp]="declined" [options]="countUpOptions"></strong>
            </div>
            <div class="dashboard-item">
                <p>קבלת הודעה</p>
                <strong [countUp]="received" [options]="countUpOptions"></strong>
            </div>
            <div class="dashboard-item">
                <p>אחוז קבלה</p>
                <strong [countUp]="successRate" [options]="countUpOptions"></strong>
            </div>
        </div>
        <div class="dashboard-container--left">
            <canvas baseChart class="dashboard-container__canvas" [data]="chartData" [labels]="chartLabels"
                [chartType]="chartType" [plugins]="chartPlugins" [options]="chartOptions" [colors]="chartColors">
            </canvas>
        </div>
    </div>

    <button class="resend-btn" mat-raised-button (click)="resend()" color="primary" 
        [disabled]="!failed && !declined">
        שלח הודעה בשנית
    </button>

    <button class="new-message-btn" mat-raised-button (click)="newMessage()" color="primary">
        הפצת הודעה נוספת
    </button>

    <button class="report-btn" mat-raised-button (click)="report()" color="accent">
        הצגת דו״ח
    </button>

    <button class="submit-btn" mat-raised-button (click)="complete()" color="warn">
        סיים אירוע
    </button>
</div>

<mat-card *ngIf="isLoading" class="mat-progress-spinner">
    <mat-progress-spinner color="primary" mode="indeterminate" diameter="70"></mat-progress-spinner>
</mat-card>

<table style="display: none;" id="excel-table" mat-table [dataSource]="messagesDataSource">
    <ng-container matColumnDef="toPhone">
        <th mat-header-cell *matHeaderCellDef> נמען </th>
        <td mat-cell *matCellDef="let message"> {{message.receiver}} - {{message.toPhone}} </td>
    </ng-container>

    <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> דרך העברת ההודעה </th>
        <td mat-cell *matCellDef="let message"> {{message.type}} </td>
    </ng-container>

    <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> סטטוס </th>
        <td mat-cell *matCellDef="let message">
            <div class="status">
                <mat-spinner *ngIf="message.status === MessageStatus.PENDING" 
                    color="warn">
                </mat-spinner>
                <span>{{message.status}}</span>
            </div> 
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="messagesColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: messagesColumns;"></tr>
</table>